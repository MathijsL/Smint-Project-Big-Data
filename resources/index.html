<html>
<head>
	<!-- SCRIPT -->
	<script src="jquery.js"></script>
	<script src="jquery-migrate.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCg219BZX5-sVkO5423wOAIwRF_OxW7F8E&callback=initMap" defer></script>
	<script src="custommarker.js"></script>

	<!-- STYLE -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="style.css">

	<!-- DATA FROM PYTHON -->
	<script>


		
		var weather = 1;
		var userLatLong = {lat: 51.90923, lng: 4.486283};
		var mapcenter = {lat: 51.92442, lng: 4.47773};
	
	</script>
</head>
<body>
	<!-- CONTENT -->
	<div class="container-fluid">
		<div class="row">
			<div class="col-xs-12 header">
				<img src="walkornot.png" class="headerimage"/>
			</div>
		</div>
		<div class="row fullheightBig">
			<div class="col-sm-12 col-md-2 contentLeft">
				<h4>
					<b>Locaties</b>
				</h4>
				<div class="locationContainer"></div> 
			</div>
			<div id="map" class="col-sm-12 col-md-10 contentRight fullheightSmall">
			</div>
		</div>
	</div>

	<!-- JAVASCRIPT -->
	<script>
		// set objects to be used in multiple functions
		var markersArray = [];
		var map = null;
		var datajson = [];

		// this function will be called when google maps is loaded
		function initMap() 
		{
			// load the google map
			map = new google.maps.Map(document.getElementById('map'), {
				center: mapcenter,
				zoom: 13,
				disableDefaultUI: true
			});
			
			// load the custom marker libraries to put the custom markers on the screen
			InitCustomMarker();
			InitCustomLocationMarker();
		  
			// load the checkboxes
			LoadData();
			
			// load the user location marker
			LoadUserMarker();
		}
		
		function LoadData(){
			$.ajax("/cgi-bin/main.py", {
				format: "json"
			}).done(function(data) {
				datajson = JSON.parse(data);
				LoadCheckboxes();
				LoadMarkers();
			});
		}	
		
		// this function loads the checkboxes according to the data from python
		function LoadCheckboxes()
		{
			var data = datajson;
			$(".locationContainer").html("");
			for(var i = 0; i < data.length; i ++)
			{
				$(".locationContainer").append("<input type='checkbox' class='"+data[i].name+"-checkbox itemCheckbox' /><label>"+data[i].name+"</label>");
			}
			$(".itemCheckbox").click(LoadMarkers);
		}

		// this function loads the markers according to the data from python and the selected checkboxes
		function LoadMarkers()
		{
			var data = datajson;
			ClearMarkers();
			for(var i = 0; i < data.length; i ++)
			{	
				var isCheckBoxChecked = $("."+data[i].name + "-checkbox").is(':checked');
				if(isCheckBoxChecked)
				{
					for(var p = 0; p < data[i].data.length; p++)
					{
						var dataitem = data[i].data[p];
						var myLatlng = new google.maps.LatLng(dataitem.lat, dataitem.lng);
						markersArray.push(new CustomMarker(
							myLatlng, 
							map,
							dataitem
						));
					}
				}
			}
		}

		// this function clears all the markers from the screen except the users location
		function ClearMarkers() 
		{
			for (var i = 0; i < markersArray.length; i++ ) {
				markersArray[i].setMap(null);
			}
			markersArray.length = 0;
		}

		// this function loads the user location marker on the screen
		function LoadUserMarker()
		{
			var myLatlng = new google.maps.LatLng(userLatLong.lat, userLatLong.lng);
			new CustomLocationMarker(
				myLatlng, 
				map,
				{}
			);
		}
	</script>
</body>
</html>